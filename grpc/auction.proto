syntax = "proto3";

package auction;

option go_package = "github.com/Xerzes01/Auction/proto";

// AuctionNode is the gRPC service that implements a distributed auction
service AuctionNode {
  // Client-facing RPCs
  rpc ClientBid(BidRequest) returns (BidReply);
  rpc QueryResult(QueryRequest) returns (QueryReply);

  // Internal replication RPC (Primary → Backup nodes)
  rpc Append(LogEntry) returns (AppendReply);
}

// ================================
// Messages used by clients
// ================================

message BidRequest {
  string bidder_id = 1;
  int32  amount    = 2;
  int64  client_id = 3;
  int64  seq_num   = 4;
}

message BidReply {
  string outcome = 1;  // "success" | "failed" | "exception"
  string reason  = 2;
}

message QueryRequest {
  // Empty request – just checking current state
}

message QueryReply {
  bool   auction_ended   = 1;
  int32  highest_amount  = 2;
  string highest_bidder  = 3;
  string message         = 4;
}

// ================================
// Messages used for replication (Raft-style log entries)
// ================================

message LogEntry {
  string bidder_id = 1;
  int32  amount    = 2;
  int64  client_id = 3;
  int64  seq_num   = 4;
}

message AppendReply {
  bool   success = 1;
  string error   = 2;
}